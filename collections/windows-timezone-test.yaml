---
- name: Check Timezone on Windows Host
  hosts: hosts
  tasks:
    # Ensure the report directory exists
    - name: Ensure reports directory exists
      local_action: 
        module: file
        path: "/tmp/reports"
        state: directory
        mode: '0777'

    - name: Get the current time zone
      win_shell: (Get-TimeZone).Id
      register: timezone_result

    - name: Assert timezone is Eastern Standard Time
      assert:
        that:
          - "timezone_result.stdout | trim == 'Eastern Standard Time'"
        fail_msg: "The timezone is not set to Eastern Standard Time. Found: {{ timezone_result.stdout | trim }}"
        success_msg: "The timezone is set to Eastern Standard Time."

    - name: Display the template content
      delegate_to: localhost
      command:
        cmd: cat windows-timezone-test.j2
      register: report_output
      changed_when: false
      ignore_errors: true

    - debug:
        var: report_output.stdout_lines

    - name: Save result as JUnit XML
      delegate_to: localhost
      template:
        src: windows-timezone-test.j2
        dest: "/tmp/reports/timezone_report.xml"
